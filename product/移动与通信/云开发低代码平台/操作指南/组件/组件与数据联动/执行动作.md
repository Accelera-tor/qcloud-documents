## 介绍
运行在前端的 JavaScript 代码块，遵循标准的 JS 语言规范。可通过自定义 JavaScript 方法实现自定义的业务逻辑，或者调用微搭官方的 [前端 API](https://cloud.tencent.com/document/product/1301/56700) 以及外部 JSSDK 等。


## 如何新建自定义 JavaScript 方法
- 建议通过编辑器左下角代码区，单击 **+** 直接新建自定义 JavaScript 方法。
<img style="width:80%; max-width: inherit;" src="https://qcloudimg.tencent-cloud.cn/raw/f0d36e96342d6325c9388646ac48056c.png" />
>?自定义 JS 方法的作用域分为页面作用域和应用全局作用域，可以按需声明。默认情况下，使用页面作用域即可。
- 也可在代码编辑器中直接新建自定义 JavaScript 方法，具体请参见 [代码编辑器](https://cloud.tencent.com/document/product/1301/57912)。


## 如何调用自定义 JavaScript 方法
- 在内部**自定义 JS** 代码之间进行调用。
例如：定义了一个全局 JS 方法 `getBalance()`，则在代码中的调用路径为 `$app.common.getBalance({...})`。若定义了一个页面作用域的 JS 方法 `getChatList()`，则调用路径为 `$page.handler.getChatList({...})`。
>?自定义 JavaScript 方法以及自定义变量和 Query 对象等的引用路径都可以在编辑器左下角代码区 > 单击 **···** > 复制调用路径快捷获取，如下所示：
![](https://qcloudimg.tencent-cloud.cn/raw/445e6096c21dcb2a6af7cbbba6b8a10f.png)
- 在**表达式**中进行调用。
在表达式中调用 JS 方法的传参方式，与上述自定义 JavaScript 方法传参相同。
![](https://qcloudimg.tencent-cloud.cn/raw/a9565fa76df5bac73b9e2ddf89641702.png)
- 在事件面板的 **JavaScript 代码方法**节点中进行调用，例如：
![](https://qcloudimg.tencent-cloud.cn/raw/52d0f4a328c0065e3278a706b6a93d61.png)
![](https://qcloudimg.tencent-cloud.cn/raw/6a6f9f50f9492328d68626941f51f0f4.png)


## 应用场景示例

### 示例1：通过自定义 JS 代码打印当前登录用户信息
该示例以点击某个按钮时，触发一个自定义 JS 方法，来打印当前登录用户的详细信息。
1. 首先，在编辑器左下角代码区单击 **+** 新建一个 **JavaScript 方法**，例如命名为 logger 并保存, 函数体示例代码如下。
```javascript
export default function({event, data}) {
  console.log('data',  data) // 打印入参data
  console.log('event', event) //打印event对象
  if(!data) {
    throw Error; //如需要在事件中触发动作执行失败的分支，则在判断分支中throw Error
  }
  return 'success'
}
```
>?在多个事件动作节点的执行过程中，某个节点执行完成后默认进入执行成功的分支，如果需要在节点执行之后触发动作执行失败的分支，则可在自定义 JS 方法中添加抛出异常代码，如上述的 `throw Error` 即可。
>
![](https://qcloudimg.tencent-cloud.cn/raw/93311114bc894103f6966538bd8a2c61.png)
2. 然后，可在编辑区拖入一个**按钮**组件，选中**按钮**组件后，在右侧组件属性面板的右下角为其配置**点击**事件，打开**事件面板** > 选择 **JavaScript 代码方法**节点 > 选择**已有方法**中刚新建的 logger 自定义 JS 方法，如下所示：
![](https://qcloudimg.tencent-cloud.cn/raw/00172196e635b3bd530398957543bd97.png)
3. 在事件面板中，为选择的自定义 JS 方法 logger 配置方法入参，例如根据表达式提示选择入参为 `$w.auth.curre` 本文主要介绍微搭编辑器内置的平台方法及使用方式。

>? 当前微搭内置的平台包括不限于以下常用方法，除了通过事件面板的可视化方式调用，下述方法也可以在自定义 JavaScript 方法中进行调用，可视化更多详细的平台方法使用说明和参数介绍请参见 [微搭内置方法 API](https://docs.cloudbase.net/lowcode/api/utils)。

## 调用数据源方法 callDataSource
调用数据源中已配置完成的方法，对数据源进行增删改查的操作。

### 方法参数

| 参数名称   | 参数说明                                                 |
| ---------- | -------------------------------------------------------- |
| 数据源名称 | 从当前环境中所有已创建的数据源进行选择                   |
| 方法名     | 对数据源方法进行选择                                     |
| 传入参数   | 若数据源方法需要入参，则在此处可以传入对应参数（非必填） |
| 显示加载   | 在数据源请求过程中显示加载提示                           |
| 显示提示   | 数据源请求完成后显示成功或失败的消息提示                 |

## 变量赋值 setState
为当前页面或全局变量进行赋值操作。

### 方法参数

| 参数名称 | 参数说明                                         |
| -------- | ------------------------------------------------ |
| 变量名   | 支持下拉选择当前页面或者是全局中已创建的全部变量 |
| 变量值   | 输入需要赋予所选变量的值                         |

## 打开页面 navigateTo
控制应用的页面跳转，页面跳转后支持使用 navigateBack 方法进行页面返回操作。

### 方法参数

| 参数名称 | 参数说明                                                                                                  |
| -------- | --------------------------------------------------------------------------------------------------------- |
| 模式     | 微搭：跳转至当前应用编辑器的其他页面<br>Web：跳转至外部页面（当构建平台为小程序时不可用）                 |
| 链接     | 模式选择微搭时：选择应用编辑器的内部页面<br>模式选择 Web 时：输入外部页面链接（当构建平台为小程序时不可用）|

## 扫码 scanCode

触发后调出手机扫码功能，支持对条形码、二维码进行识别。

### 方法参数

| 参数名称                                 | 参数说明                                                                                      |
| ---------------------------------------- | --------------------------------------------------------------------------------------------- |
| 是否只能从手机扫码，不允许从相册选择图片 | 扫码时是否支持选择手机相册图片                                                                |
| 是否开启默认管理                         | 在 Web 环境下若扫码内容为链接则自动弹窗打开，否则展示扫码内容。在小程序环境下自动弹窗显示内容 |
| 扫码类型                                 | 选择可识别的扫码类型，目前支持条形码、二维码                                                  |

### 使用示例
#### 如何把扫码后获取的值填写到表单中？
1. 新建一个普通变量（codeResult），页面中添加一个按钮和一个单行输入组件，单行输入组件的输入值绑定新建的普通变量。
![](https://qcloudimg.tencent-cloud.cn/raw/f7c697fb870c5339684416058873b2e1.png)
2. 选择按钮，为按钮配置**事件** > **点击时**进行扫码，扫码成功时给变量赋值（`event.detail.result` 为获取二维码对应的链接值）。
![](https://qcloudimg.tencent-cloud.cn/raw/de422597f75316fbd3f26cc43b1bef2a.png)
3. 应用发布为小程序后，即可用手机打开小程序来查看效果，单击按钮扫描任意二维码可查看结果。

## 其他平台方法说明
更多平台方法的使用说明，请参见 [微搭内置工具/交互方法说明](https://docs.cloudbase.net/lowcode/api/utils)。
ntUser`（currentUser 为微搭 [内置系统变量](https://cloud.tencent.com/document/product/1301/86577#.E5.86.85.E7.BD.AE.E7.B3.BB.E7.BB.9F.E5.8F.98.E9.87.8F)，表示当前登录用户），完成配置后单击**保存**。
![](https://qcloudimg.tencent-cloud.cn/raw/1ccec0c579fc96d23792998bc0d09d9c.png)
4. 确认上述配置后，回到编辑区单击“按钮”即可触发事件对应的自定义 JS 方法，打开编辑器右下角**开发调试工具**，即可查看单击时的打印日志，如下所示：
![](https://qcloudimg.tencent-cloud.cn/raw/9d1f960d12e94fe5912ffb3db0bf09c3.png)



### 示例2：实现通过用户 openid 来查询用户表中的详细信息
该示例以在**页面加载**时，通过一个自定义 JS 方法，实现通过已知的小程序 openid 来从数据表中查询当前用户的更多详细信息为例，具体操作过程如下。
1. 首先，在编辑器左下角代码区单击 **+** 新建一个 **JavaScript 方法**，例如命名为 getUserInfo，函数体示例代码如下。
```javascript
export default async function({event, data}) {

    var wxa = await app.utils.getWXContext();
    const openid = wxa.OPENID || wxa.FROM_OPENID || app.auth.currentUser.openId;
    console.log("get userinfo openid: ", openid);

    // 提前定义一个全局变量`userInfo`，用于存储获取到的用户信息，方便其他地方引用
    $app.dataset.state.userInfo = await app.cloud.callModel({
        name: 'diy_user_xxxx', // 数据源标识，请自行新建一个用户表`diy_user`，之后可在数据源列表中看到该标识 
        methodName: 'wedaGetItem', 
        params: {
          where: [{
              key: "openid",
              rel: "eq",
              val: openid,
          }],
        },
    });

    console.log("getuserinfo: ", $app.dataset.state.userInfo);

}
```
2. 然后，在编辑器左侧大纲树选择**页面根节点**之后，在右侧属性面板右下角可选择对应的事件触发条件，例如选择**页面加载**，在之后打开的事件面板中选择 **JavaScript 代码**节点，即可完成在页面加载时，例如上自定义 JS 方法的调用，参考步骤如下：
![](https://qcloudimg.tencent-cloud.cn/raw/b331b5cca888b82ef13c93f3fcbb766b.png)
3. 完成上述配置之后，可刷新页面，打开编辑器右下角的**开发调试工具**，即看到打印日志。
![](https://qcloudimg.tencent-cloud.cn/raw/b2fab205259a7a8895d5ec5567952849.png)
